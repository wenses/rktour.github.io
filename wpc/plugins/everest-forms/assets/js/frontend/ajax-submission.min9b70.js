jQuery(function(c){"use strict";c('form[data-ajax_submission="1"]').each(function(e,o){c(document).ready(function(){var f=c(o),m=f.find(".evf-submit");f.find("[data-gateway='razorpay']");m.on("click",async function(e){var a=f.find(".everest-forms-stripe-gateways-tabs .evf-tab").has("a.active").data("gateway");if(undefined===a&&f.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"),f.find(".everest-forms-gateway[data-gateway='stripe']").hasClass("StripeElement--empty")&&c(".evf-field-credit-card ").is(":visible"))return c(document).ready(function(){c("#card-errors").html("This field is required").show(),c(".evf-submit").text("Submit"),c(".evf-submit").attr("disabled",!1)}),f.trigger("focusout").trigger("change").trigger("submit"),!1;var t,a=f.find(".everest-forms-gateway[data-gateway='square']").find(".sq-card-message-error");if(0<a.length)return t=a.text(),c(document).ready(function(){c("#card-errors").html(t).show(),c(".evf-submit").text("Submit"),c(".evf-submit").attr("disabled",!1)}),f.trigger("focusout").trigger("change").trigger("submit"),!1;"undefined"!=typeof tinyMCE&&tinyMCE.triggerSave();a=m.get(0).recaptchaID;if(0===a)return grecaptcha.execute(a),!1;a=f.serializeArray(),e.preventDefault(),f.trigger("focusout").trigger("change").trigger("submit"),e=f.find(".evf-error:visible");if(c(".everest-forms-authorize_net[data-gateway='authorize-net']").length){var s=window.EverestFormsAuthorizeNet.getCardData(f);if(!Object.values(s).some(e=>!e)){s=new Promise(function(e,a){window.EverestFormsAuthorizeNet.authorizeNetAjaxSubmitHandler(o).then(e)["catch"](a)});try{var r=await s;"Ok"===r.messages.resultCode&&a.push({name:"everest_forms[authorize_net][opaque_data][descriptor]",value:r.opaqueData.dataDescriptor},{name:"everest_forms[authorize_net][opaque_data][value]",value:r.opaqueData.dataValue})}catch(i){return}}e.length<1&&(e=f.parents("div.everest-forms").find(".everest-forms-notice.everest-forms-notice--error .evf-error"))}0<e.length?c([document.documentElement,document.body]).animate({scrollTop:e.last().offset().top},800):(c(this).html(f.data("process-text")),a.push({name:"action",value:"everest_forms_ajax_form_submission"}),c.ajax({url:everest_forms_ajax_submission_params.ajax_url,type:"POST",data:a}).done(function(i,e,a){var o=i.data&&i.data.redirect_url?i.data.redirect_url:"";if(o&&"stripe"!==f.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway")&&"square"!==f.find(".everest-forms-gateway[data-gateway='square']").data("gateway")){if(f.trigger("reset"),!(i.data.enable_redirect_in_new_tab||!1))return void(window.location.href=o);var d=window.open(o,"_blank");d&&!d.closed&&"undefined"!=typeof d.closed||(window.location.href=o)}if(i&&i.payment_method&&"paypal"===i.payment_method&&i.redirect&&"paypal"===i.payment_method)window.location.href=i.redirect;else if("success"===i.data.response||!0===i.success){let e="",a="",t="",s="",r="";i.data.form_id!==undefined&&i.data.entry_id!==undefined&&1==i.data.pdf_download&&(e='<br><small><a href="/?page=evf-entries-pdf&form_id='+i.data.form_id+"&entry_id="+i.data.entry_id+'">'+i.data.pdf_download_message+"</a></small>"),1==i.data.quiz_result_shown&&(a=i.data.quiz_reporting),"1"==i.data.is_preview_confirmation&&(t=i.data.preview_confirmation),i.data.message_display_location!==undefined&&""!==i.data.message_display_location&&(s=i.data.message_display_location),i.data.form_state_type!==undefined&&""!==i.data.form_state_type&&(r=i.data.form_state_type);var d=f.find(".everest-forms-stripe-gateways-tabs .evf-tab").has("a.active").data("gateway");"stripe"===(d=undefined===d?"ideal"===(d=f.find(".everest-forms-gateway[data-gateway='ideal']").data("gateway"))?"ideal":f.find(".everest-forms-gateway[data-gateway='stripe']").data("gateway"):d)&&"none"!==f.find(".everest-forms-gateway[data-gateway='stripe']").closest(".evf-field").css("display")?f.trigger("everest_forms_frontend_before_ajax_complete_success_message",i.data):"ideal"===(d=undefined===d?f.find(".everest-forms-gateway[data-gateway='ideal']").data("gateway"):d)&&"none"!==f.find(".everest-forms-gateway[data-gateway='ideal']").closest(".evf-field").css("display")?f.trigger("evf_process_payment",i.data):"square"===f.find(".everest-forms-gateway[data-gateway='square']").data("gateway")?f.trigger("everest_forms_frontend_payment_before_success_message",i.data):(f.trigger("reset"),f.closest(".everest-forms").find(".everest-forms-notice").remove(),"hide"===s?f.closest(".everest-forms").html('<div class="everest-forms-notice everest-forms-notice--success" role="alert">'+i.data.message+e+"</div>"+a+t).focus():"top"===s?f.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--success" role="alert">'+i.data.message+e+"</div>"+a+t).focus():"bottom"===s?f.closest(".everest-forms").append(t+'<div class="everest-forms-notice everest-forms-notice--success" role="alert">'+i.data.message+e+"</div>"+a).focus():"popup"===s&&(c("body").css("overflow","hidden"),o=`
									<div class="everest-forms-popup-overlay">
										<div class="everest-forms-popup">
											<div class="everest-forms-popup-close">
												<svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
												<path d="M7 6.06668L1.26666 0.333344L0.333328 1.20001L6.06666 6.93334L0.333328 12.6L1.26666 13.5333L7 7.86668L12.6667 13.5333L13.6 12.6L7.93333 6.93334L13.6667 1.33334L12.7333 0.466677L7 6.06668Z" fill="#383838"/>
												</svg>
											</div>
											<img src="${everest_forms_ajax_submission_params.evf_checked_image_url}" alt="Checked Logo" class="everest-forms-popup-success-logo">
											<p class="everest-forms-popup-success-text">${everest_forms_ajax_submission_params.i18n_evf_success_text}</p>
											<p>${i.data.message}</p>
										</div>
									</div>
								`,c("body").append(o),c(".everest-forms-popup-close").on("click",function(){c(".everest-forms-popup-overlay").fadeOut(200,function(){c(this).remove(),c("body").css("overflow","")})}),f.closest(".everest-forms").append(t+a).focus()),"hide"===r&&c(".evf-frontend-row, .evf-submit-container ").hide(),m.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit),d=new CustomEvent("everest_forms_ajax_submission_success",{detail:{formId:"evf-form-"+i.data.form_id}}),document.dispatchEvent(d))}else{var n=f.data("formid"),o=JSON.parse(a.responseText),d=(i="undefined"!=typeof o.data[n]?o.data[n].header:everest_forms_ajax_submission_params.error,o.data.error);"string"==typeof o.data.message&&(i=o.data.message),f.closest(".everest-forms").find(".everest-forms-notice").remove(),f.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+i+"</div>").focus(),c(d).each(function(e,a){var s,t=Object.values(a)[0],r=Object.keys(a)[0],a=!0,i="evf"-+n+"-field_"+r+"-container";c("#"+i).hasClass("evf-field-signature")?s=c("#"+("evf-signature-img-input-"+r)):c("#"+i).hasClass("evf-field-likert")?(a=!1,(s=c('[id^="'+("everest_forms-"+n+"-field_"+r+"_")+'"]')).each(function(e,a){var a=c(a).closest("tr.evf-"+n+"-field_"+r).find("th"),t="everest_forms[form_fields]["+r+"]["+(parseInt(a.closest("tr").index())+1)+"]";a.children().is("label")?a.children().find("#"+t).show():(a.parents("span.input-wrapper").length?a.parents("span.input-wrapper"):a).append('<label id="'+t+'" for="'+t+'" class="evf-error">'+everest_forms_ajax_submission_params.required+"</label>")})):c("#"+i).hasClass("evf-field-address")?(s=c('[id^="'+("evf-"+n+"-field_"+r)+'"]')).each(function(e,a){var t=String(c(a).attr("id"));(t.includes("-container")||t.includes("-address2")||void 0!==c(a).val())&&s.splice(e,1)}):s=c("#"+("evf-"+n+"-field_"+r)),s.addClass("evf-error"),s.attr("aria-invalid",!0),s.first().closest(".evf-field").addClass("everest-forms-invalid evf-has-error"),!0!==a||s.is("label")||(s.parents("span.input-wrapper").length?s.parents("span.input-wrapper"):s).after('<label id="'+s.attr("id")+'-error" class="evf-error" for="'+s.attr("id")+'">'+t+"</label>").show()}),m.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit)}}).fail(function(){m.attr("disabled",!1).html(everest_forms_ajax_submission_params.submit),f.trigger("focusout").trigger("change"),f.closest(".everest-forms").find(".everest-forms-notice").remove(),f.closest(".everest-forms").prepend('<div class="everest-forms-notice everest-forms-notice--error" role="alert">'+everest_forms_ajax_submission_params.error+"</div>").focus()}).always(function(e){!(e.data&&e.data.redirect_url?e.data.redirect_url:"")&&c(".everest-forms-notice").length&&"1"===e.data.submission_message_scroll&&c([document.documentElement,document.body]).animate({scrollTop:c(".everest-forms-notice").offset().top},800)}))})})})});