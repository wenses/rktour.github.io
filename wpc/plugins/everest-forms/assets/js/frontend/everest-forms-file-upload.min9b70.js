"use strict";!function(o){function f(e){var r,t=jQuery(e.element).closest("form"),s=t.find(".everest-forms-submit"),e=0<e.loading,o=(r=t,function(){r.find(".everest-forms-uploading-in-progress-alert").length||r.find(".everest-forms-submit-container").before('<div class="everest-forms-error-alert everest-forms-uploading-in-progress-alert">'+window.everest_forms_upload_parms.loading_message+"</div>")});e?(s.prop("disabled",!0),t.find(".everest-forms-submit-overlay").length||(s.parent().addClass("everest-forms-submit-overlay-container"),s.parent().append('<div class="everest-forms-submit-overlay"></div>'),t.find(".everest-forms-submit-overlay").css("width",s.outerWidth()+"px"),t.find(".everest-forms-submit-overlay").css("height",s.parent().outerHeight()+"px"),t.find(".everest-forms-submit-overlay").on("click",o))):(s.prop("disabled",!1),t.find(".everest-forms-submit-overlay").off("click",o),t.find(".everest-forms-submit-overlay").remove(),s.parent().removeClass("everest-forms-submit-overlay-container"),t.find(".everest-forms-uploading-in-progress-alert").length&&t.find(".everest-forms-uploading-in-progress-alert").remove())}function t(e){try{return JSON.parse(e)}catch(r){return!1}}function s(e){return 0<e.length}function i(e){return e}function n(e){return e.xhr}function a(e){return e.responseText}function d(e){return e.data}function m(e){var r=jQuery(e.element).parents(".evf-field-image-upload, .evf-field-file-upload").find("input[name="+e.dataTransfer.name+"]");r.val((e=e.files,(e=e.map(n).filter(i).map(a).filter(s).map(t).filter(i).map(d)).length?JSON.stringify(e):"")).trigger("input"),"undefined"!=typeof jQuery.fn.valid&&r.valid()}function l(e){setTimeout(function(){e.files.filter(function(e){return e.accepted}).length>=e.options.maxFiles?e.element.querySelector(".dz-message").classList.add("hide"):e.element.querySelector(".dz-message").classList.remove("hide")},0)}function u(r){return function(e){var t,s;t=e,s=r,setTimeout(function(){var e,r;t.size>=s.dataTransfer.postMaxSize&&(e=window.everest_forms_upload_parms.errors.post_max_size,t.isErrorNotUploadedDisplayed||(t.isErrorNotUploadedDisplayed=!0,e=window.everest_forms_upload_parms.errors.file_not_uploaded+" "+e),(r=document.createElement("span")).innerText=e,r.setAttribute("data-dz-errormessage",""),t.previewElement.querySelector(".dz-error-message").appendChild(r))},1),l(r)}}function p(r){return function(e){l(r),e.xhr&&(e=t(e.xhr.responseText))&&(e=e.data.file,wp.ajax.post({action:"everest_forms_remove_file",file:e,form_id:r.dataTransfer.formId,field_id:r.dataTransfer.fieldId})),m(r)}}function c(e){var r=parseInt(e.dataset.formId,10),t=e.dataset.fieldId,s=parseInt(e.dataset.maxFileNumber,10),o=parseInt(e.dataset.currentFileCount,10)||0;try{e.dataset.existingFiles&&JSON.parse(e.dataset.existingFiles)}catch(l){console.error("Error parsing existing files:",l)}var i,n,a=e.dataset.extensions.split(",").map(function(e){return"."+e}).join(","),d=new window.Dropzone(e,{url:window.everest_forms_upload_parms.url,addRemoveLinks:!0,maxFilesize:(parseInt(e.dataset.maxSize,10)/1e6).toFixed(2),maxFiles:s-o,acceptedFiles:a,dictMaxFilesExceeded:window.everest_forms_upload_parms.errors.file_limit.replace("{fileLimit}",s),dictInvalidFileType:window.everest_forms_upload_parms.errors.file_extension,dictFileTooBig:window.everest_forms_upload_parms.errors.file_size,timeout:everest_forms_upload_parms.max_timeout});return d.dataTransfer={name:e.dataset.inputName,postMaxSize:parseInt(e.dataset.postMaxSize,10),formId:r,fieldId:t},d.on("sending",(i={action:"everest_forms_upload_file",form_id:r,field_id:t},function(e,r,t){e.size>this.dataTransfer.postMaxSize?(r.send=function(){},e.accepted=!1,e.processing=!1,e.status="rejected",e.previewElement.classList.add("dz-error"),e.previewElement.classList.add("dz-complete")):(this.loading=this.loading||0,this.loading++,f(this),Object.keys(i).forEach(function(e){t.append(e,i[e])}))})),d.on("addedfile",u(d)),d.on("removedfile",p(d)),jQuery(document).on("evf_frontend_reset_button",function(){d.removeAllFiles()}),d.on("complete",(n=d,function(){n.loading=n.loading||0,n.loading--,f(n),m(n)})),d.on("error",function(e,r){e.isErrorNotUploadedDisplayed||(e.isErrorNotUploadedDisplayed=!0,e.previewElement.querySelectorAll("[data-dz-errormessage]")[0].textContent=window.everest_forms_upload_parms.errors.file_not_uploaded+" "+r)}),d}function e(){window.everest_forms=window.everest_forms||{},window.everest_forms.dropzones=[].slice.call(document.querySelectorAll(".everest-forms-uploader")).map(c),jQuery(document).on("everest-forms-uploads-init",function(e,r){c(r)}),jQuery(document).on("elementor/popup/show",function(e,r){(r.$element||document).querySelectorAll(".everest-forms-uploader").forEach(e=>c(e))}),o(document).on("click",".evf-remove-file",function(e){var r=o(this).closest(".everest-forms-uploader")[0].dropzone.options.maxFiles,r=(o(this).closest(".everest-forms-uploader")[0].dropzone.options.maxFiles=++r,o(this).closest(".everest-forms-uploader").find(".dz-message").show(),o(this).closest(".dz-preview").find(".existing-file").val()),t=o(this).closest(".everest-forms-uploader").find(".deleted-input"),s=t.val();if(s)try{s=JSON.parse(s),Array.isArray(s)?s.push(r):s=[s,r]}catch(e){s=[s,r]}else s=[r];t.val(JSON.stringify(s)),o(this).closest(".dz-preview").remove()})}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",e):e()}(jQuery);